{"pages":[{"title":"","text":"ä¼°ç®—ä½ çš„ 5E å¤©æ¢¯åˆ†æ•°ä¼°ç®—ä½ çš„ 5E å¤©æ¢¯åˆ†æ•°è¯·è¾“å…¥è¦æŸ¥è¯¢çš„ç©å®¶ 5e ä¸»é¡µé“¾æ¥ èŒƒä¾‹ï¼šhttps://www.5ewin.com/data/player/ec2d3z ä¼°ç®—æŸ¥è¯¢ç»“æœusernameelovar fiveEProfilePrefix = 'https://www.5ewin.com/data/player/'; var apiEndPoint = 'https://5e-elo-estimator.azurewebsites.net/api/infer-elo?code=uBqXdMi6ney0iD3zLBepnfSsalnFH1/JXFTz7SFSAOfu8Ab9Vom3wg=='; var profileUrlTextBox = $('#5e-profile-url'); var button = $('#estimate-button'); var buttonText = $('#estimate-button-text'); var spinner = $('#estimate-loading'); var resultPanel = $('.result'); var userIdText = $('#user-id'); var userEloText = $('#user-elo'); var userAvatarImg = $('#user-avatar'); function startEstimatingStatus() { profileUrlTextBox.attr('disabled', true); button.attr('disabled', true); buttonText.text('ä¼°ç®—ä¸­...'); spinner.removeAttr('hidden'); resultPanel.attr('hidden', true); } function endEstimatingStatus() { profileUrlTextBox.removeAttr('disabled'); button.removeAttr('disabled'); buttonText.text('ä¼°ç®—'); spinner.attr('hidden', true); } $('#estimate-button').on('click', function () { startEstimatingStatus(); var profileUrl = $('#5e-profile-url').val(); if (!profileUrl.startsWith(fiveEProfilePrefix)) { alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ 5E ä¸»é¡µé“¾æ¥!'); endEstimatingStatus(); return; } axios.get(apiEndPoint + `&id=${profileUrl}`) .then((function (resp) { if (resp.status != 200) { alert('æœåŠ¡å™¨è¿”å›çŠ¶æ€ç ï¼š' + resp.status); return; } var data = resp.data; if (data.success) { resultPanel.removeAttr('hidden'); userAvatarImg.attr('src', data.data.avatar); userIdText.text(data.data.username); if (data.data.elo != 0) { userEloText.text(data.data.elo); } else { userEloText.text(`${data.data.lower_limit}~${data.data.upper_limit}`); } } else { alert('æŸ¥è¯¢å¤±è´¥ï¼ŒåŸå› ï¼š' + data.message); } })) .finally(function () { endEstimatingStatus(); }); });","link":"/5e-elo.html"},{"title":"æŸ¯åŸç‰ / Tony Ke","text":"TO BE ADDED SOON","link":"/about/index.html"},{"title":"Categories","text":"","link":"/categories/index.html"},{"title":"Tags","text":"","link":"/tags/index.html"},{"title":"","text":"ä¼°ç®—ä½ çš„ 5E å¤©æ¢¯åˆ†æ•°ä¼°ç®—ä½ çš„ 5E å¤©æ¢¯åˆ†æ•°è¯·è¾“å…¥è¦æŸ¥è¯¢çš„ç©å®¶ 5e ä¸»é¡µé“¾æ¥ èŒƒä¾‹ï¼šhttps://www.5ewin.com/data/player/ec2d3z ä¼°ç®—æŸ¥è¯¢ç»“æœusernameelovar fiveEProfilePrefix = 'https://www.5ewin.com/data/player/'; var apiEndPoint = 'https://5e-elo-estimator.azurewebsites.net/api/infer-elo?code=uBqXdMi6ney0iD3zLBepnfSsalnFH1/JXFTz7SFSAOfu8Ab9Vom3wg=='; var profileUrlTextBox = $('#5e-profile-url'); var button = $('#estimate-button'); var buttonText = $('#estimate-button-text'); var spinner = $('#estimate-loading'); var resultPanel = $('.result'); var userIdText = $('#user-id'); var userEloText = $('#user-elo'); var userAvatarImg = $('#user-avatar'); function startEstimatingStatus() { profileUrlTextBox.attr('disabled', true); button.attr('disabled', true); buttonText.text('ä¼°ç®—ä¸­...'); spinner.removeAttr('hidden'); resultPanel.attr('hidden', true); } function endEstimatingStatus() { profileUrlTextBox.removeAttr('disabled'); button.removeAttr('disabled'); buttonText.text('ä¼°ç®—'); spinner.attr('hidden', true); } $('#estimate-button').on('click', function () { startEstimatingStatus(); var profileUrl = $('#5e-profile-url').val(); if (!profileUrl.startsWith(fiveEProfilePrefix)) { alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ 5E ä¸»é¡µé“¾æ¥!'); endEstimatingStatus(); return; } axios.get(apiEndPoint + `&id=${profileUrl}`) .then((function (resp) { if (resp.status != 200) { alert('æœåŠ¡å™¨è¿”å›çŠ¶æ€ç ï¼š' + resp.status); return; } var data = resp.data; if (data.success) { resultPanel.removeAttr('hidden'); userAvatarImg.attr('src', data.data.avatar); userIdText.text(data.data.username); if (data.data.elo != 0) { userEloText.text(data.data.elo); } else { userEloText.text(`${data.data.lower_limit}~${data.data.upper_limit}`); } } else { alert('æŸ¥è¯¢å¤±è´¥ï¼ŒåŸå› ï¼š' + data.message); } })) .finally(function () { endEstimatingStatus(); }); });","link":"/5e-elo/index.html"}],"posts":[{"title":"æŒä¹‹ä»¥æ’è®­ç»ƒæ‰“å¡è®°å½•","text":"å¤±è´¥äº†ï¼ŒåšæŒäº†3ä¸ªæœˆï¼Œè´¥ç»™æ‡’æƒ°æ¯å¤©åšæŒåš 100 ä¸ªä¿¯å§æ’‘æ¯å¤©åšæŒä¸€é¡¹å®¤å†…ä½“è‚²è¿åŠ¨ï¼Œæš‚å®šæŒç»­ä¸€å¹´ã€‚æ²¡æœ‰ç‰¹æ®Šçš„å¥èº«ç›®çš„ï¼Œåªæ˜¯ä¸ºäº†å¯»æ‰¾ä¸€ä»¶äº‹æƒ…è®©è‡ªå·±æ¯å¤©éƒ½åŠªåŠ›å»å®Œæˆï¼Œé”»ç‚¼è‡ªå¾‹æ€§ã€‚æœ€å¼€å§‹çš„ç‰ˆæœ¬æ˜¯ä¸€å¤© 100 ä¸ªä¿¯å§æ’‘ï¼Œåæ¥å’¨è¯¢ä¸€ä¸‹å‘ç°ä¿¯å§æ’‘æ˜¯è¦éš”å¤©åšçš„ï¼Œå› ä¸ºä¼šå¯¹è‚Œè‚‰äº§ç”ŸåŠ³æŸï¼Œæ‰€ä»¥æ‰“ç®—æ‰¾å¤šå‡ ç§è¿åŠ¨æ¥æŒ‘æˆ˜ï¼Œä¸å±€é™äºä¿¯å§æ’‘ä» Jan.16, 2019 å¼€å§‹åˆ° Jan.16, 2020 ç»“æŸï¼Œç„¶åå¼€å§‹æ–°çš„æŒ‘æˆ˜AprilApr.10-18 æš‚åœä¸€ä¸‹ï¼Œè¿™é˜µå­èº«ä½“å®åœ¨ä¸å¤ªè¡ŒApr.3-9 åˆç”Ÿç—…äº†ï¼Œä¼‘æ¯ä¸€ä¸‹Apr.2 ä¿¯å§æ’‘ 75 ä¸ªApr.1 ä¿¯å§æ’‘ 75 ä¸ªMarchMar.31 ä¿¯å§æ’‘ 75 ä¸ªMar.30 ä¿¯å§æ’‘ 75 ä¸ªMar.29 ä¿¯å§æ’‘ 75 ä¸ªMar.28 ä¿¯å§æ’‘ 75 ä¸ªMar.27 ä¿¯å§æ’‘ 75 ä¸ªMar.26 ä¿¯å§æ’‘ 75 ä¸ªMar.25 ä¿¯å§æ’‘ 75 ä¸ªMar.24 ä¿¯å§æ’‘ 75 ä¸ªMar.23 ä¿¯å§æ’‘ 75 ä¸ªMar.22 ä¿¯å§æ’‘ 75 ä¸ªMar.21 ä¿¯å§æ’‘ 75 ä¸ªMar.20 ä¿¯å§æ’‘ 75 ä¸ªMar.19 ä¿¯å§æ’‘ 75 ä¸ªMar.13-18 ç”Ÿç—…äº†ï¼Œä¼‘æ¯ä¸€ä¸‹Mar.12 ä¿¯å§æ’‘ 75 ä¸ªMar.11 ä¿¯å§æ’‘ 100 ä¸ªMar.10 æ·±è¹² 75 ä¸ªMar.9 å‰ªè¹² 75 ä¸ªMar.8 ä¿¯å§æ’‘ 75 ä¸ªMar.7 ä¿¯å§æ’‘ 75 ä¸ªMar.6 ä¿¯å§æ’‘ 75 ä¸ªMar.5 ä¿¯å§æ’‘ 75 ä¸ªMar.4 ä¿¯å§æ’‘ 75 ä¸ªMar.3 ä¿¯å§æ’‘ 75 ä¸ªMar.2 ä¿¯å§æ’‘ 75 ä¸ªMar.1 ä¿¯å§æ’‘ 75 ä¸ªFebruaryFeb.28 ä¿¯å§æ’‘ 75 ä¸ªFeb.27 ä¿¯å§æ’‘ 75 ä¸ªFeb.26 ä¿¯å§æ’‘ 75 ä¸ªFeb.25 ä¿¯å§æ’‘ 75 ä¸ªFeb.24 ä¿¯å§æ’‘ 75 ä¸ªFeb.23 ä¿¯å§æ’‘ 75 ä¸ªFeb.22 ä¿¯å§æ’‘ 75 ä¸ªFeb.21 ä¿¯å§æ’‘ 75 ä¸ªFeb.20 ä¿¯å§æ’‘ 75 ä¸ªFeb.19 å‰ªè¹² 100 ä¸ªFeb.18 ä¿¯å§æ’‘ 75 ä¸ªFeb.17 æ·±è¹² 100 ä¸ªFeb.16 ä»°å§èµ·å 100 ä¸ªFeb.15 å‰ªè¹² 100 ä¸ªFeb.14 ä¿¯å§æ’‘ 75 ä¸ªFeb.13 æ·±è¹² 100 ä¸ªFeb.12 ä¿¯å§æ’‘ 65 ä¸ªFeb.11 ä¿¯å§æ’‘ 75 ä¸ªFeb.10 ä¿¯å§æ’‘ 75 ä¸ªFeb.9 ä¿¯å§æ’‘ 75 ä¸ªFeb.8 æ·±è¹² 100 ä¸ªFeb.7 ä¿¯å§æ’‘ 75 ä¸ªFeb.6 ä¿¯å§æ’‘ 75 ä¸ªFeb.5 ä¿¯å§æ’‘ 75 ä¸ªFeb.5 ä¿¯å§æ’‘ 75 ä¸ªFeb.4 æ·±è¹² 100 ä¸ªFeb.3 å‰ªè¹² 80 ä¸ªFeb.2 ä¿¯å§æ’‘ 75 ä¸ªFeb.1 æ·±è¹² 60 ä¸ªJanuaryJan.31 ä¿¯å§æ’‘ 50 ä¸ªJan.30 ä¿¯å§æ’‘ 50 ä¸ªJan.29 ä¿¯å§æ’‘ 50 ä¸ªJan.28 å‰ªè¹² 100 ä¸ªJan.27 ä¿¯å§æ’‘ 50 ä¸ª + å‰ªè¹² 100 ä¸ªï¼Œè‚©è†€é…¸Jan.26 ä»°å§èµ·å 100 ä¸ªJan.25 ä¿¯å§æ’‘ 60 ä¸ªJan.24 ä¿¯å§æ’‘ 60 ä¸ªJan.23 ä¿¯å§æ’‘ 40 ä¸ªJan.22 å‰ªè¹² 80 ä¸ªJan.21 æ·±è¹² 75 ä¸ªJan.20 ä¿¯å§æ’‘ 40 ä¸ªJan.19 ä»°å§èµ·å 80 ä¸ªJan.18 å‰ªè¹² 100 ä¸ªJan.17 æ·±è¹² 80 ä¸ªJan.16 ä¿¯å§æ’‘ 100 ä¸ª","link":"/2019/01/16/365-days-challenge/"},{"title":"ç”± Eval å¼•ç”³åˆ° Redis Cluster çš„å­¦ä¹ ","text":"èƒŒæ™¯å› ä¸ºä¸šåŠ¡éœ€è¦å†™äº†ä¸€æ®µ Redis çš„ Lua Scriptï¼Œåœ¨è°ƒç”¨ EVAL çš„æ—¶å€™å‘ç°è¿˜æœ‰ä¸¤ä¸ªå‚æ•° KEYS å’Œ ARGVï¼Œæ„Ÿè§‰å¾ˆç–‘æƒ‘ï¼Œéš¾é“ä¸æ˜¯ç®€å•çš„ä¼ ç‚¹å‚æ•°è¿›å»å°±å¯ä»¥ï¼Ÿæ‰€ä»¥äº†è§£äº†ä¸€ä¸‹è¿™ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰ã€‚EVAL å‘½ä»¤çš„å®šä¹‰æ˜¯1EVAL script numkeys key [key ...] arg [arg ...]All Redis commands must be analyzed before execution to determine which keys the command will operate on. In order for this to be true for EVAL, keys must be passed explicitly. This is useful in many ways, but especially to make sure Redis Cluster can forward your request to the appropriate cluster node.Redis è®¾è®¡çš„åŸæ„æ˜¯ä½¿ç”¨è€…åº”å½“å°†åœ¨ Lua Script ä¸­æ“ä½œçš„æ‰€æœ‰ KEY ä»¥ KEYS çš„å½¢å¼ä¼ ç»™ EVALï¼Œè¿™æ · EVAL èƒ½å¤Ÿåœ¨çœŸæ­£è¿è¡Œå‰æ£€æŸ¥ä¸€ä¸‹ KEYï¼Œå°±ç›®å‰æ¥è¯´ï¼Œæ˜¯æ ¹æ® KEYS æ¥å†³å®šæŠŠæŒ‡ä»¤è½¬å‘åˆ°å“ªå° Redis Cluster Master Node ä¸Šã€‚ARGV åˆ™æ˜¯ä¼ é€’ä¸€äº›å¿…è¦çš„å‚æ•°ï¼Œè¿™ä¸ªå€’æ˜¯æ²¡ä»€ä¹ˆä½¿ç”¨è§„èŒƒã€‚äºæ˜¯æˆ‘å…ˆæ”¾ä¸‹ EVALï¼Œäº†è§£ä¸€ä¸‹ Redis Clusterï¼Œç”¨äº†è¿™ä¹ˆä¹… Redis äº†ï¼Œè¿˜æ²¡ç”¨è¿‡ Redis Clusterï¼Œæƒ­æ„§ã€‚Redis ClusterRedis Cluster ç®€å•çš„æ¥è¯´å°±æ˜¯è‹¥å¹² Redis èŠ‚ç‚¹ç»„æˆé›†ç¾¤ï¼Œæ•°æ®æ ¹æ® KEY è¢«åˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šé¢ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹ä¹‹é—´äº’ä¸º Replicationã€‚KEY çš„åˆ†æ•£ç­–ç•¥ä¸æ˜¯ Consistent Hashingï¼Œè€Œæ˜¯ä¸€ç§å«åš Slots çš„æœºåˆ¶ï¼Œåœ¨æ–‡ç« æœ€åæˆ‘å†ä»‹ç»ä¸€ä¸‹æˆ‘å¯¹ Slots æœºåˆ¶çš„ç†è§£ã€‚ä¹Ÿæ­£æ˜¯å› ä¸º Slots æœºåˆ¶ï¼ŒæŒ‡ä»¤åˆ°è¾¾ Redis Cluster çš„èŠ‚ç‚¹ä¹‹åä¼šæ ¹æ® KEY é€‰æ‹©åˆé€‚çš„ Slotï¼Œç„¶åå®¢æˆ·ç«¯é‡æ–°è¿æ¥åˆ°å¯¹åº”çš„èŠ‚ç‚¹å†æ‰§è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯æŸä¸ªèŠ‚ç‚¹è½¬å‘æŒ‡ä»¤åˆ°å¯¹åº” KEY çš„èŠ‚ç‚¹ã€‚ä¸€ä¸ª Redis Cluster ä¸€å…±æœ‰ 16384 ä¸ª Slotsï¼Œæœ€å¼€å§‹åˆ›å»ºé›†ç¾¤çš„æ—¶å€™è¿™ 16384 ä¸ª Slots ä¼šè¢«å¹³å‡åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥æ‰‹åŠ¨è°ƒæ•´ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯ 16384 ä¸ª Slotsï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ä½œè€…åœ¨è¿™ä¸ª Issue ä¸Šçš„å›ç­”Availabilityå‰é¢è¯´åˆ° Redis èŠ‚ç‚¹ä¹‹é—´æ•°æ®äº’ç›¸ç‹¬ç«‹ï¼Œæ‰€ä»¥åªè¦æœ‰èŠ‚ç‚¹æŒ‚äº†ï¼Œè¿™ä¸ªèŠ‚ç‚¹è´Ÿè´£çš„ Slots çš„æ•°æ®ä¹Ÿå˜å¾—æ— æ³•è®¿é—®ä»è€Œæ•´ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹éƒ½ä¼šæ‹’ç»è®¿é—®ï¼Œå¤„äº CLUSTERDOWN çš„çŠ¶æ€ã€‚å› æ­¤ Redis Cluster ä¹Ÿåˆ©ç”¨äº† Master-Slave æœºåˆ¶ç”¨äºæä¾› Availabilityï¼Œå³ Master èŠ‚ç‚¹ä¼šå¼‚æ­¥å¤åˆ¶è‡ªå·±çš„æ•°æ®ï¼ˆå…¶å®æ˜¯å¤åˆ¶æ“ä½œï¼‰åˆ°å®ƒ N ä¸ªçš„ Slave èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Slot å¯¹åº”çš„ Key ä»¬ä¼šæœ‰ N+1 ä»½æ•°æ®åˆ†å¸ƒåœ¨ Master å’Œ Slave ä¸Šã€‚å½“æŸä¸ª Master æŒ‚äº†çš„æ—¶å€™ï¼Œé›†ç¾¤ä¼šæŠŠå®ƒçš„ Slave å‡çº§åˆ° Masterï¼Œè¿™æ ·å­é›†ç¾¤å°±èƒ½ç»§ç»­å·¥ä½œã€‚å½“ç„¶ï¼Œå¦‚æœä¸€å¯¹ Master-Slave éƒ½æŒ‚äº†é‚£é›†ç¾¤ä¹Ÿå°±æŒ‚äº†ã€‚é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šåœ¨ Master ä¸Šè¿›è¡Œï¼ŒSlave åªæ˜¯å……å½“å¤‡èƒçš„ä½œç”¨ï¼Œåªæœ‰ Master æŒ‚äº† Slave æ‰èƒ½ä¸Šä½ã€‚ä¸è¿‡ Slave ä¹Ÿä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æ‰§è¡Œ READONLY å‘½ä»¤æ¥å°†å®¢æˆ·ç«¯åˆ‡æ¢åˆ°åªè¯»æ¨¡å¼ï¼Œè¿™æ ·å­è¯»æ“ä½œå°±ä¼šåœ¨ Slave ä¸Šè¿›è¡Œã€‚ConsistencyRedis Cluster å¹¶ä¸èƒ½ä¿è¯å¾ˆå¥½çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨æŸäº›æç«¯æƒ…å†µä¸‹è¿˜æ˜¯æœ‰å¯èƒ½ä¸¢æ•°æ®çš„ï¼šç¬¬ä¸€ç§ä¸¢å¤±æ•°æ®çš„æƒ…å†µMaster æ²¡æœ‰æˆåŠŸå¤åˆ¶æ¶ˆæ¯åˆ° Slaveã€‚åœ¨ Master-Slave æ¨¡å¼ä¸‹ï¼Œå¯¹ Master çš„æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå³æ“ä½œæˆåŠŸåæ‰ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ç›¸åº”çš„æ¶ˆæ¯ï¼Œä½†æ˜¯ Master -&gt; Slave çš„å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œå‡è®¾ä¸€ç§æƒ…å†µï¼šå®¢æˆ·ç«¯ SET a 1Master æ¥æ”¶åˆ°æŒ‡ä»¤ SET a 1ï¼Œå›å¤ç»™å®¢æˆ·ç«¯ OKMaster åœ¨å‘é€ç»™ Slave SET a 1 ä¹‹å‰å´©äº†Slave ä¸Šä½æˆ Masterè¿™æ—¶å€™ a=1 è¿™ä¸ªæ•°æ®å°±ä¸¢å¤±äº†ã€‚è¿™ç§æƒ…å†µä¹Ÿä¸æ˜¯ä¸èƒ½é¿å…ï¼ŒRedis Cluster æä¾›äº† WAIT æŒ‡ä»¤æ¥åšåˆ°è¿™ä»¶äº‹æƒ…ã€‚å®¢æˆ·ç«¯å‘é€ WAIT æŒ‡ä»¤ä¹‹åï¼ŒRedis Cluster ä¼š Block ä½ç›´åˆ°å®¢æˆ·ç«¯çš„ä¸Šä¸€æ¡æ“ä½œæœ‰ N ä¸ª Slave éƒ½å›å¤ ACK äº†ã€‚ç¬¬äºŒç§ä¸¢å¤±æ•°æ®çš„æƒ…å†µç½‘ç»œéš”ç¦»ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤ï¼Œæ¯ä¸ª Master èŠ‚ç‚¹æœ‰ä¸€ä¸ª Slaveï¼ŒèŠ‚ç‚¹å‘½åä¸º A-A1, B-B1, C-C1ï¼Œä»¥åŠä¸€ä¸ªå®¢æˆ·ç«¯ Då‘ç”Ÿç½‘ç»œéš”ç¦»çš„æƒ…å†µä¸‹ï¼ŒD å’Œå°‘æ•° Masterï¼ˆCï¼‰ å½¢æˆä¸€ä¸ªå­¤å²›ï¼Œå…¶ä»–å¤§å¤šæ•° Master å½¢æˆä¸€ä¸ªå­¤å²›ã€‚å­¤å²› ADã€Cå­¤å²› BAã€A1ã€Bã€B1ã€C1t0C ä¸é›†ç¾¤å¤±è”ï¼Œå¼€å§‹ç­‰å¾…æ¢å¤è¿æ¥ç­‰å¾…æ—¶é—´ä¸º node timeout[4]é›†ç¾¤ä¸ B å¤±è”ï¼Œå¼€å§‹ç­‰å¾… B æ¢å¤è¿æ¥ç­‰å¾…æ—¶é—´ä¸º node timeoutt1D å‘ C èŠ‚ç‚¹å†™æ•°æ®æŒç»­ç­‰å¾…t2C ç­‰å¾…è¶…æ—¶åˆ‡æ¢çŠ¶æ€åˆ° errorï¼Œæ‹’ç»å†™å…¥æ–°æ•°æ®é›†ç¾¤ç­‰å¾…è¶…æ—¶é€šè¿‡é€‰ä¸¾å°† C1 æå‡ä¸ºæ–°çš„ Mastert3ä¸é›†ç¾¤æ¢å¤è”ç³»ä¸ D C æ¢å¤è”ç³»æ¢å¤è”ç³»åï¼Œå› ä¸ºåŸæ¥çš„ Master C å·²ç»è¢«å¤šæ•°æˆå‘˜è®¤ä¸ºä¸å¯ç”¨æ·˜æ±°æ‰äº†ï¼ŒC1 è¢«é€‰ä¸ºæ–°çš„ Masterï¼ŒC åŠ å›é›†ç¾¤åè¢«é™çº§ä¸º Slaveã€‚å› ä¸ºå…ˆå‰ D å‘ C å†™çš„æ•°æ®æ²¡æœ‰åŒæ­¥åˆ° C1ï¼Œæ‰€ä»¥æ•°æ®ä¸¢å¤±ã€‚å›åˆ° EVALåœ¨ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ° EVAL æŒ‡ä»¤ä¹‹åï¼Œä»–ä¼šæ£€æŸ¥ KEYSï¼Œç®—å‡ºå¯¹åº”çš„ Slotsï¼Œå¦‚æœæ‰€æœ‰ KEY ä¸æ˜¯è½åˆ°åŒä¸€ä¸ª Slot ä¸Šï¼Œä¼šæç¤º CROSSSLOT Keys in request don't hash to the same sloté‚£å¦‚æœæˆ‘ä¸ä¼  KEYSï¼Œç›´æ¥åœ¨è„šæœ¬ä¸­æ“ä½œå‘¢ï¼Ÿè¿˜æ˜¯ä¼šæŠ¥é”™ã€‚12$ redis-cli EVAL &quot;redis.call(&apos;get&apos;, &apos;slot a&apos;); redis.call(&apos;get&apos;, &apos;slot-b&apos;)&quot; 0ERR Error running script (call to f_8ead0f68893988e15c455c0b6c8ab9982e2e707c): @user_script:1: @user_script: 1: Lua script attempted to access a non local key in a cluster nodeæ‰€ä»¥ EVAL çš„æ—¶å€™ï¼Œè„šæœ¬ä¸­æ“ä½œçš„ Key åº”å½“ä¿è¯è½åœ¨åŒä¸€ä¸ª Slot é‡Œé¢ã€‚åŒæ—¶ Redis ä¹Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•å¯ä»¥ä¿è¯ Key éƒ½ä¼šè½åˆ°åŒä¸€ä¸ª Slot ä¸Šé¢ï¼Œä¸‹é¢è®² Slots æœºåˆ¶çš„æ—¶å€™ä¼šè®²åˆ°ä»¥ä¸Šå…³äº EVAL çš„æ“ä½œéƒ½æ˜¯å»ºç«‹åœ¨å¯¹ Redis Cluster æ“ä½œçš„åŸºç¡€ä¸Šçš„ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯å•ä¸€èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥ä¸è€ƒè™‘è¿™äº›é—®é¢˜ï¼Œå¯ä»¥èƒ¡æ¥ã€‚Note this rule is not enforced in order to provide the user with opportunities to abuse the Redis single instance configuration, at the cost of writing scripts not compatible with Redis Cluster.Slots æœºåˆ¶SLOT = CRC16(key) mod 16384Redis é›†ç¾¤çš„æ‹“æ‰‘ç»“æ„æ˜¯æ˜¯ä¸€ä¸ªå…¨è¿é€šçš„ç½‘ç»œï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½ä¼šå»ºç«‹ä¸€ä¸ª Cluster Busï¼Œæ‰€ä»¥é›†ç¾¤çš„ä»»ä½•é…ç½®å˜åŠ¨éƒ½ä¼šç«‹å³åŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“å“ªäº› Slot å¯¹åº”å“ªä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥ä¸è®ºå®¢æˆ·ç«¯è¿æ¥åˆ°å“ªä¸ªèŠ‚ç‚¹è¿›è¡Œæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šæ­£ç¡®çš„æŒ‡ç¤ºå®¢æˆ·ç«¯åº”å½“é‡å®šå‘åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹æ¥æ“ä½œã€‚Key åœ¨åš CRC16 çš„æ—¶å€™ï¼Œå¦‚æœ Key ä¸­å­˜åœ¨èŠ±æ‹¬å·å¯¹ï¼ŒRedis ä¼šä½¿ç”¨èŠ±æ‹¬å·å¯¹é‡Œé¢å­—ç¬¦ä¸²åš CRC16ï¼Œä¾‹å¦‚12{user:info:}1234 =&gt; crc16(&quot;user:info:&quot;) % 16384{user:info:}5737 =&gt; crc16(&quot;user:info:&quot;) % 16384è™½ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„ Keyï¼Œä½†æ˜¯èŠ±æ‹¬å·ä¸­é—´éƒ¨åˆ†æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä»–ä»¬æœ‰ç›¸åŒçš„ Slotã€‚å‚è€ƒèµ„æ–™[1] https://github.com/antirez/redis/issues/2576[2] https://redis.io/topics/cluster-spec[3] https://redis.io/commands/eval[4] https://redis.io/topics/cluster-tutorial","link":"/2019/04/17/a-glance-at-redis-cluster/"},{"title":"åœ¨ macOS ä¸Šæ„å»ºã€æ‰“åŒ… Medis","text":"Medis æ˜¯ä¸€æ¬¾ç®€æ´æ˜“ç”¨ã€å®ç”¨çš„ Redis å›¾å½¢åŒ–å®¢æˆ·ç«¯ï¼Œä½œè€…å°†è¿™æ¬¾è½¯ä»¶åœ¨ Github ä¸Šå¼€æºï¼Œæ‰€æœ‰å¼€å‘è€…å¯ä»¥è‡ªç”±ä¸‹è½½å®ƒçš„æºä»£ç ã€‚Medis åœ¨ App Store ä¸Šæä¾›äº†ä¸‹è½½ï¼Œä»·å€¼ Â¥30ï¼Œç®—æ˜¯ä¸€ç§å½¢å¼ä¸Šçš„æèµ å§ï¼Œä¸æ„¿æ„èŠ±é’±çš„å¼€å‘è€…ä¹Ÿå¯ä»¥æ ¹æ®æœ¬æ–‡çš„æŒ‡ç¤ºæ¥æ„å»ºå¹¶æ‰“åŒ… Medisï¼Œä¸ä» App Storeä¸‹è½½çš„ç‰ˆæœ¬å¹¶æ— åŒºåˆ«ã€‚å‰æXcode &gt;= 8.2.1macOS &gt;= 10.11.6Node 8ï¼ˆæˆ‘åªåœ¨è£…äº† Node 8 çš„æœºå™¨ä¸Šå°è¯•è¿‡ï¼‰è‡ªåŠ›æ›´ç”Ÿ123456789101112131415161718192021# 1. ä¸‹è½½æœ€æ–°æºä»£ç $ git clone https://github.com/luin/medis.gitCloning into 'medis'...remote: Counting objects: 3154, done.remote: Total 3154 (delta 0), reused 0 (delta 0), pack-reused 3154Receiving objects: 100% (3154/3154), 48.44 MiB | 1.89 MiB/s, done.Resolving deltas: 100% (1745/1745), done.$ cd medis# 2. å®‰è£…ä¾èµ–$ npm install...added 1295 packages from 1824 contributors in 49.707s# 3. æ‰“åŒ…ï¼Œå¿½ç•¥ Unhandled rejection Error$ npm run packPackaging app for platform mas x64 using electron v1.4.15flating... ~/Desktop/medis/out/Medis-mas-x64/Medis.appUnhandled rejection Error: No identity found for signing. at ~/Desktop/medis/node_modules/electron-osx-sign/flat.js:114:35 ...(stack error info)è‡³æ­¤ï¼ŒMedis å·²ç»æ‰“åŒ…å®Œæ¯•ï¼ŒMedis.app å­˜æ”¾åœ¨ Medis æºä»£ç ç›®å½•ä¸‹çš„ out/Medis-mas-x64 ç›®å½•é‡Œé¢ï¼Œè¿è¡Œ Medis.app å³å¯å¯åŠ¨ Mediså®‰è£…ä¹Ÿå¯ä»¥åœ¨ Finder ä¸­å°† Medis.app æ”¾å…¥åº”ç”¨ç¨‹åºç›®å½•æ¥å®‰è£…ï¼Œä¹Ÿå¯ä»¥ç”¨è¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š12# æ­¤æ—¶å¤„äº Medis æºä»£ç æ ¹ç›®å½•ä¸‹$ mv out/Medis-mas-x64/Medis.app ~/ApplicationsLetâ€™s enjoy Medis!Thank you luin!","link":"/2018/07/18/build-medis-on-macos/"},{"title":"Kubernetes å­¦ä¹ æœ­è®° - åœ¨ Google Cloud ä¸Šæ­å»ºé›†ç¾¤","text":"Targetæ­å»º Kubernetes é›†ç¾¤ï¼ˆMaster * 1 + Node * 2ï¼‰MachinesHostnameMachine Typekube-mastern1-standardkube-node-1n1-standardkube-node-2n1-standardPreparation on Master Machineå®‰è£… Docker å’Œ Kubeadmä¿å­˜ä¸‹é¢è„šæœ¬ä¸º init-k8s-master.sh123456789101112131415161718192021#!/bin/sh# install dockerapt-get updateapt-get install -y apt-transport-https ca-certificates curl software-properties-commoncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"apt-get updateapt-get install -y docker-ce# install k8scurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -echo \"deb http://apt.kubernetes.io/ kubernetes-xenial main\" &gt;&gt; /etc/apt/sources.list.d/kubernetes.listapt-get updateapt-get install -y kubelet kubeadm kubectl# ONLY run on master# configure cgroupsed -i \"s/cgroup-driver=systemd/cgroup-driver=cgroupfs/g\" /etc/systemd/system/kubelet.service.d/10-kubeadm.confsystemctl daemon-reloadsystemctl restart kubeletæ‰§è¡Œä¸Šè¿°è„šæœ¬ sudo source init-k8s-master.shé€‰æ‹©ä¸€ä¸ª Pod ç½‘ç»œç»„ä»¶ï¼ˆPod Network Add-onï¼‰ç»„ä»¶æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº† Flannelï¼Œå…·ä½“æ“ä½œè§æ¥ä¸‹æ¥ä¸¤ä¸ªæ­¥éª¤å¯åŠ¨é›†ç¾¤ Master12# è¿™é‡Œçš„ --pod-network-cidr=10.244.0.0/16 å–å†³äºä½ é€‰æ‹©çš„ç½‘ç»œç»„ä»¶sudo kubeadm init --pod-network-cidr=10.244.0.0/16å¯åŠ¨äº†ä¹‹åä»ç»“æœçš„æœ€åå‡ è¡Œé‡Œé¢è·å¾—ä¸€ä¸²å‘½ä»¤è¡Œï¼Œç”¨äºæ“ä½œ Node åŠ å…¥é›†ç¾¤ï¼Œè®°ä¸‹æ¥ï¼Œè¿™ä¸ªå‘½ä»¤è¡Œæœ‰ç”¨123# è·å¾—ä¸€ä¸²ç±»ä¼¼äºè¿™æ ·å­çš„å‘½ä»¤# 10.0.0.3 æ˜¯æˆ‘çš„ Master IPkubeadm join 10.0.0.3:6443 --token 8qn683.9ft7dc6xa0re697a --discovery-token-ca-cert-hash sha256:65773046272db8297b64cbc1ce8ebc3884fa932976673fad7715c2bd8c53c6a0è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿è°ƒç”¨ kubectlå¦‚æœæƒ³è®©é root ç”¨æˆ·ä½¿ç”¨ kubectl ï¼Œæ‰§è¡Œ123mkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/configå¯¹äº root ç”¨æˆ·ï¼Œç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡1export KUBECONFIG=/etc/kubernetes/admin.confè¿™æ ·è®¾ç½®ä¹‹åï¼Œ kubectl æ‰èƒ½æ­£å¸¸è¿è¡Œå®‰è£…ç½‘ç»œç»„ä»¶æ£€æŸ¥èŠ‚ç‚¹123$ kubectl get nodesNAME STATUS ROLES AGE VERSIONkube-master NotReady master 1m v1.11.0ä¼šå‘ç° STATUS ä¸º NotReady ï¼Œè¿è¡Œ kubectl describe nodes å¾—åˆ°æœ€åä¸€è¡Œæ—¥å¿—æ˜¯ Container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized ï¼Œè¯´æ˜ç½‘ç»œç»„ä»¶è¿˜æ²¡æœ‰é…ç½®å¥½ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘é€‰æ‹©äº† Flannel ä½œä¸ºç½‘ç»œç»„ä»¶ï¼Œæ‰§è¡Œ1kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.10.0/Documentation/kube-flannel.ymlå†æ¬¡æ£€æŸ¥èŠ‚ç‚¹123$ kubectl get nodesNAME STATUS ROLES AGE VERSIONkube-master Ready master 2m v1.11.0è‡³æ­¤ Master é…ç½®å®Œæ¯•ï¼Œå‡†å¤‡é…ç½® NodePreparation for Node Machineså®‰è£… Docker å’Œ Kubeadmå‚ç…§ Master å®‰è£…æ•™ç¨‹ï¼Œåˆ å» cgroup é…ç½®éƒ¨åˆ†åŠ å…¥é›†ç¾¤12# åœ¨ Master è¿›è¡Œ kubeadm init çš„æ—¶å€™è·å¾—çš„æç¤ºkubeadm join 10.0.0.3:6443 --token 8qn683.9ft7dc6xa0re697a --discovery-token-ca-cert-hash sha256:65773046272db8297b64cbc1ce8ebc3884fa932976673fad7715c2bd8c53c6a0æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€åœ¨ Master ä¸Šæ‰§è¡Œ kubectl get nodes12345$ kubectl get nodesNAME STATUS ROLES AGE VERSIONkube-master Ready master 2m v1.11.0kube-node-1 Ready master 3m v1.11.0kube-node-2 Ready master 3m v1.11.0æ‰€æœ‰ STATUS å‡ä¸º Readyï¼Œå®Œç¾èµ„æ–™å‚è€ƒï¼šCreating a single master cluster with kubeadm","link":"/2018/07/06/learn-k8s-1/"},{"title":"ä½¿ç”¨ GitHub Actions å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½² Hexo åšå®¢","text":"GitHub äº 2018 å¹´ 8 æœˆå‘å…¬ä¼—å®£å‘Šäº†ä»–ä»¬çš„ CI ç³»ç»Ÿ GitHub Actionsï¼Œè¿™æ˜¯ä¸€å¥—è‡ªåŠ¨åŒ–çš„å·¥ä½œæµç³»ç»Ÿï¼Œå¯ä»¥å¯¹ä¸€ä¸ªé¡¹ç›®çš„å¼€å‘èµ·åˆ°å¾ˆå¥½çš„è¾…åŠ©ä½œç”¨ã€‚ç›´åˆ°æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒGitHub Actions è¿˜å¤„äº Beta é˜¶æ®µã€‚æˆ‘å·²ç»æ‹¿åˆ°äº†æµ‹è¯•èµ„æ ¼ï¼Œå‡ºäºå°é²œçš„ç›®çš„ï¼Œä¾¿æŠŠæˆ‘çš„åšå®¢çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ä» Travis è½¬ç§»åˆ° Actions ä¸Šã€‚å†™æ­¤æ–‡ç« åˆ†äº«æˆ‘å¯¹ GitHub Actions çš„äº†è§£ã€‚ç”±äºæˆ‘ä¹‹å‰åªç”¨è¿‡ Travis å’Œ Jenkinsï¼Œè€Œ Jenkins çš„ä½¿ç”¨ä½œä¸ºä¸€ä¸ªéè¿ç»´äººå‘˜æ¥è¯´æ˜¯ä¸å¤ªéœ€è¦å…³å¿ƒçš„ï¼Œæ‰€ä»¥ä¸‹æ–‡ä»‹ç» Actions çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ›´å¤šåœ°ä¼šé€šè¿‡å¯¹æ¯” Travis æ¥è¿›è¡Œä»‹ç»ã€‚ç®€å•ä»‹ç» GitHub Actionså¸‚é¢ä¸Šæ¯”è¾ƒæµè¡Œçš„åŒç±»äº§å“æœ‰ï¼šTravisï¼Œæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åœ¨çº¿ CI/CD æœåŠ¡æä¾›å•†ï¼Œä¸€å¼€å§‹å‘ GitHub çš„ä»“åº“æä¾›å…è´¹æœåŠ¡ï¼Œåæ¥éé€æ¸åœ°æˆä¸ºäº†å¤šæ•° GitHub ç”¨æˆ·çš„é¦–é€‰AppVeyorï¼Œä¸ Travis ä¸åŒçš„æ˜¯ï¼ŒAppVeyor æä¾›äº†æ¯”è¾ƒå¥½çš„ Windows ç¯å¢ƒæ”¯æŒï¼Œè¿™å¸å¼•äº†ä¸€éƒ¨åˆ† Windows è½¯ä»¶å¼€å‘è€…Jenkinsï¼Œè¿™æ˜¯ä¸€å¥—å¼€æºçš„ CI/CD ç³»ç»Ÿï¼Œå¾ˆå¤šå•†ä¸šå…¬å¸ä¼šé€‰æ‹©åœ¨å†…éƒ¨æœåŠ¡å™¨è‡ªå·±æ­å»ºä¸€å¥—å®Œæ•´çš„ CI/CD ç³»ç»Ÿï¼Œå¹¶ä¸ä»–ä»¬çš„ç§æœ‰åº“ä»¥åŠçº¿ä¸Šæœºå™¨é›†ç¾¤ç»“åˆèµ·æ¥ï¼Œä»è€Œä¼˜åŒ–å·¥ä½œæµã€‚æˆ‘çš„å‰ä¸œå®¶ä»¬ï¼ˆå­—èŠ‚è·³åŠ¨ã€å³åˆ»ï¼‰ä½¿ç”¨çš„éƒ½æ˜¯è¿™æ ·å­çš„ç»“æ„ä¸€äº›æ¦‚å¿µWorkflowä¸€ä¸ª Workflow å³æ˜¯ä¸€ä¸ªå¯é…ç½®çš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œè¿™ä¸ªå·¥ä½œæµç”±å•ä¸ªæˆ–è€…å¤šä¸ª Job ç»„æˆã€‚å·¥ä½œæµçš„å¯åŠ¨å¯ä»¥é€šè¿‡äº‹ä»¶ï¼ˆæ¯”å¦‚ git pushï¼‰æ¥è§¦å‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥è§¦å‘ã€‚Workflow çš„é…ç½®é€šè¿‡ä¸€ä¸ª yaml æ–‡æ¡£æ¥ä½“ç°ï¼Œè¿™ä¸ªæ–‡æ¡£å­˜æ”¾åœ¨ &lt;repo&gt;/.github/workflows/&lt;workflow_name&gt;.ymlï¼Œå…·ä½“è§„èŒƒå¯è§ Workflow syntax for GitHub Actionsï¼Œæœ¬æ–‡ä¸ä¼šæåŠæ‰€æœ‰è¯­æ³•å†…å®¹ï¼Œåªä¼šè¦†ç›–éœ€è¦ç”¨åˆ°çš„è¯­å¥ã€‚Jobç”±ä¸€ç³»åˆ—å…·ä½“ Step ç»„æˆçš„ä¸€ä¸ªä»»åŠ¡ã€‚æ¯ä¸€ä¸ª Job ä¼šè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒé‡Œé¢ã€‚Job ä¹‹é—´å¯ä»¥æ˜¯å¹¶è¡Œçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œè¿™ä¸ªå¯ä»¥åœ¨ Workflow ä¸­è¿›è¡Œé…ç½®ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å››ä¸ª Job ç»„æˆï¼šä¸¤ä¸ªç¼–è¯‘åŸºç¡€ç»„ä»¶çš„ Jobï¼ˆå¹¶è¡Œï¼‰ä¸€ä¸ªç¼–è¯‘ä¸»ç¨‹åºçš„ Jobï¼ˆä¾èµ–ä¸Šé¢ä¸¤ä¸ª Jobï¼‰ä¸€ä¸ªè¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„ Jobï¼ˆå½“ä¸”ä»…å½“ä¸»ç¨‹åº Job ç¼–è¯‘æˆåŠŸçš„æ—¶å€™è¿è¡Œï¼‰StepStep å®šä¹‰äº†æ¯ä¸€ä¸ªæ­¥éª¤æ‰€åšçš„äº‹æƒ…ï¼Œå¯ä»¥æ˜¯è¿è¡ŒæŸè¡Œå‘½ä»¤ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨æŸä¸€ä¸ª Actionã€‚Step çš„è¿è¡Œä¸å¦æ˜¯å¯ä»¥é€šè¿‡æ¡ä»¶æ¥æ§åˆ¶çš„ï¼Œä½†æœ¬æ–‡ä¸ä¼š Cover è¿™ä¸ªå†…å®¹ã€‚Actionä¸€ä¸ª Workflow å¯ä»¥æŠ½è±¡æˆä¸ºä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œåˆ†äº«ç»™åˆ«äººä½¿ç”¨ã€‚Action å°±æ˜¯è¿™æ ·çš„å­˜åœ¨ã€‚åœ¨ GitHub Actions é‡Œé¢ï¼Œæ˜¯ä¸ä¼šåƒ Travis é‚£æ ·é»˜è®¤ä»å½“å‰ Repo å» Clone æºç çš„ï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ª Step æ¥ Checkoutã€‚å½“ç„¶ï¼Œæ¯æ¬¡å†™ Workflow éƒ½è¦å†™ä¸Š git clone blablabla æ— ç–‘æ˜¯å¯¹äººåŠ›çš„ä¸€ç§ä¸å¿…è¦æŸè€—ï¼Œäºæ˜¯å°±æœ‰äº†ä¸€ä¸ªå«åš checkout çš„ Actionã€‚ä½¿ç”¨ Action éƒ¨ç½² Hexoå…ˆè´´ä¸Šæˆ‘çš„ Workflow å®šä¹‰ deploy.ymlï¼Œç„¶åæˆ‘ä»¬é€è¡Œè§£æè¿™ä»½ Workflow å®šä¹‰1234567891011121314151617181920212223242526272829303132name: Compile and Deploy to GitHub Pageon: push: branches: - sourcejobs: build: runs-on: ubuntu-18.04 steps: - uses: actions/checkout@v1 with: submodules: true ref: refs/heads/source - uses: actions/setup-node@v1 with: node_version: '8.x' - name: Setup Git user info run: | git config --global user.email \"thagki9@outlook.com\" git config --global user.name \"GitHub Actions\" - name: Install dependencies run: npm ci - name: Compile and deploy blog run: ./deploy.sh env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}Workflow çš„åç§°12# line 1name: Compile and Deploy to GitHub Pageå®šä¹‰è¿™ä¸ª Workflow çš„åç§°ä¸ºã€ŒCompile and Deploy to GitHub Pageã€è§¦å‘æ¡ä»¶12345# line 3-6on: push: branches: - sourceå®šä¹‰äº†åœ¨äº‹ä»¶ push å‘ç”Ÿï¼Œå¹¶ä¸”ç›®æ ‡åˆ†æ”¯ä¸º source çš„æ—¶å€™è§¦å‘è¿™ä¸ª WorkflowJobs12345678910# line 8-10jobs: build: runs-on: ubuntu-18.04 steps: - ... - ... - ... - ... - ...åœ¨è¿™ä¸ªç®€å•çš„é¡¹ç›®é‡Œé¢ï¼Œæˆ‘åªæœ‰ä¸€ä¸ªå«åš build çš„ Jobï¼ŒåŸºç¡€è¿è¡Œç¯å¢ƒæ˜¯ ubuntu-18.04ï¼Œç›®å‰å¯ä»¥é€‰æ‹©çš„åŸºç¡€ç¯å¢ƒæœ‰ ubuntu, windows å’Œ macOSã€‚è¿™ä¸ª Job åŒ…å«äº† 5 ä¸ªå°ä»»åŠ¡æ­¥éª¤ 1ã€2ã€3ï¼šè®¾ç½®åŸºç¡€ç¯å¢ƒ1234567891011121314# line 12-24 - uses: actions/checkout@v1 with: submodules: true ref: refs/heads/source - uses: actions/setup-node@v1 with: node_version: '8.x' - name: Setup Git user info run: | git config --global user.email \"thagki9@outlook.com\" git config --global user.name \"GitHub Actions\"ç¬¬ä¸€ä¸ªæ­¥éª¤ä½¿ç”¨äº† actions/checkout çš„é¢„å®šä¹‰ Actionï¼Œæºå¸¦äº†å‚æ•° submodules å’Œ refï¼Œè¡¨ç¤ºå°†ä¼šä»é»˜è®¤ç›®å½•ï¼ˆè·Ÿç¯å¢ƒå˜é‡æœ‰å…³ï¼‰Clone åˆ†æ”¯ sourceï¼Œå¹¶ä¸” Clone ç›¸åº”çš„ submoduleã€‚ç¬¬äºŒä¸ªæ­¥éª¤ä½¿ç”¨äº† actions/setup-node ï¼Œæºå¸¦å‚æ•° node_versionï¼Œè¡¨ç¤ºå°†ä¼šè®¾ç½®å¥½ node 8.x çš„ç¯å¢ƒã€‚ç¬¬ä¸‰ä¸ªæ­¥éª¤æˆ‘ç»™ä»–å®šä¹‰äº†ä¸ªåå­—å«åšã€ŒSetup Git user infoã€ï¼Œè¿è¡Œäº†ä¸¤è¡Œå‘½ä»¤ï¼Œç”¨äºè®¾ç½® git å‘½ä»¤è¡Œçš„é»˜è®¤é‚®ç®±å’Œåç§°ã€‚å…³äºå‚æ•°çš„ä½¿ç”¨ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ªå«åš Context çš„æ¦‚å¿µï¼Œä¸è¿‡åœ¨ä¸Šé¢æ¦‚å¿µä»‹ç»çš„æ—¶å€™æˆ‘æ²¡æœ‰æåŠï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯» Contexts and expression syntax for GitHub Actionsã€‚æ­¥éª¤ 4ï¼šå®‰è£…é¡¹ç›®ä¾èµ–123# line 26-27 - name: Install dependencies run: npm ciè¿™ä¸ªæ­¥éª¤åªæ‰§è¡Œäº†ä¸€è¡Œå‘½ä»¤ï¼Œé‚£å°±æ˜¯ npm ciï¼Œç”¨äºå®‰è£…é¡¹ç›®çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒåŒ…æ‹¬ Hexo ç­‰ç­‰ã€‚æ­¥éª¤ 5ï¼šæ‰§è¡Œéƒ¨ç½²è„šæœ¬12345# line 29-32 - name: Compile and deploy blog run: ./deploy.sh env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯æ‰§è¡Œè„šæœ¬çš„æ—¶å€™é™„å¸¦äº†ä¸€ä¸ª GITHUB_TOKEN çš„ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å†…å®¹æ˜¯ $ ï¼Œè¿™æ˜¯ä¸€ç§ Actions Workflow æä¾›çš„è¯­æ³•ï¼Œç”¨äºä½¿ç”¨ä¸€äº›çµæ´»çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è¿™ä¸ªè¡¨è¾¾å¼çš„æ„æ€å°±æ˜¯ä» secrets è¿™ä¸ª Context æ‹¿ GITHUB_TOKEN è¿™ä¸ªå€¼ã€‚secrets.GITHUB_TOKEN å…¶å®æ˜¯ GitHub Actions é¢„å®šä¹‰çš„ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ä¸€ä¸ª OAuth Access Tokenï¼Œå¯ä»¥ç”¨æ¥å¯¹ GitHub åº“è¿›è¡Œè¯»å†™æ“ä½œã€‚æ˜¾ç„¶æˆ‘ä»¬ä¸æ„¿æ„åœ¨ Workflow é‡Œé¢å†™ä¸Šè‡ªå·±çš„ GitHub è´¦æˆ·å’Œå¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ° Access Token æ¥ Push æœ€ç»ˆçš„åšå®¢é™æ€æ–‡ä»¶åˆ° GitHub Page åº“ã€‚å¹¶ä¸”ç”±äº GitHub Actions æœ‰å¯¹æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤ï¼Œæ‰€ä»¥ secrets ä¸‹çš„æ‰€æœ‰å˜é‡æ˜¯ä¸ä¼šæ³„éœ²åˆ°æ—¥å¿—é‡Œé¢çš„ã€‚deploy.sh çš„å†…å®¹æˆ‘å°±ä¸è§£æäº†ï¼Œå¤§æ¦‚å°±æ˜¯ Clone äº†åŸæœ‰çš„ GitHub Pages ä»“åº“ï¼Œåˆ æ‰é‡Œé¢çš„æ‰€æœ‰ä¸œè¥¿ï¼Œç„¶åé‡æ–°ç”Ÿæˆï¼Œä»¥äº§ç”Ÿæ­£ç¡®çš„ Diff è®°å½•ï¼Œæœ€å Commit &amp; Pushã€‚GitHub Actions çš„æœºä¼šé‚£ä¹ˆï¼Œä½œä¸ºä¸€æ¬¾æ–°å…¥å¸‚åœºçš„äº§å“ï¼ŒActions å‡­ä»€ä¹ˆèƒ½å’Œå…¶ä»–æˆç†Ÿäº§å“ç«äº‰å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥æœ‰å‡ ä¸ªå…³é”®ç‚¹ä¸ GitHub çš„æ— ç¼èåˆæ˜¯å¤©ç”Ÿä¼˜åŠ¿ï¼Œåœ¨ Actions èƒ½ç”¨çš„æƒ…å†µä¸‹ï¼Œè°åˆä¼šå»ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ CI/CD å‘¢Workflow çš„å¯å¤ç”¨æ€§åœ¨ GitHub è¿™ä¸ªå¼€æºç¤¾åŒºæ˜¾å¾—æ›´ä¸ºè€€çœ¼ï¼Œå‡å°‘äº†å¾ˆå¤šé‡å¤å·¥ä½œï¼Œå…¶å®ä¸Šé¢è¿™äº›éƒ¨ç½²æ­¥éª¤ï¼Œæˆ‘ç›¸ä¿¡æˆ‘å»æœç´¢ä¸€ä¸‹ã€ŒGitHub Actions Workflow Deploy Hexoã€ï¼Œç›´æ¥ uses ä¸€ä¸‹åº”è¯¥ä¹Ÿæ˜¯ OK çš„å¾®è½¯çš„æ…·æ…¨ï¼šæ¯ä¸ª Repo å¯ä»¥åŒæ—¶è¿è¡Œ 20 ä¸ª Workflowï¼›æ¯ä¸ª Job å¯ä»¥è¿è¡Œé•¿è¾¾ 6 ä¸ªå°æ—¶ï¼›é«˜æ€§èƒ½çš„è¿è¡Œç¯å¢ƒã€‚è¿™æ— ç–‘æ˜¯å¯¹å¼€æºç¤¾åŒºçš„ä¸€ç§é¦ˆèµ ï¼Œå¼€æºè½¯ä»¶çš„ CI/CD å¯ä»¥æ›´é«˜æ•ˆåœ°æ¨è¿›åŠŸèƒ½çš„å¼ºå¤§ï¼šåœ¨ä»”ç»†é˜…è¯»äº†æ–‡æ¡£ä¹‹åæˆ‘å‘ç° Actions æä¾›çš„åŠŸèƒ½æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œè½»é‡ Workflow é…ç½®ä¹Ÿèµ‹äºˆäº† Actions æ›´å¤šçš„å¯èƒ½ã€‚å¦‚æœåœ¨æ­£å¼å•†ç”¨ä¹‹åèƒ½å¤Ÿç»™å‡ºæ¯”è¾ƒåˆé€‚çš„ä»·æ ¼ï¼Œæˆ‘ç›¸ä¿¡æœ‰äº›å°å‹ä¼ä¸šæ˜¯ä¼šä¹æ„ä½¿ç”¨ GitHub + GitHub Actions çš„æ¨¡å¼æ¥è¿›è¡Œå¼€å‘çš„","link":"/2019/09/20/hexo-cicd-on-github-actions/"},{"title":"SSL Handshake è¢«è«åå…¶å¦™åœ° RST","text":"æœ€è¿‘æˆ‘æ¥çš„å¤–åŒ…é¡¹ç›®ç”²æ–¹åˆè¦å¼€ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œäºæ˜¯ä¸¢è¿‡æ¥å‡ å°é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ï¼Œæˆ‘æ¥è´Ÿè´£æœåŠ¡å™¨åŸºç¡€æ¶æ„çš„æ­å»ºï¼Œå…¶å®ä¹Ÿå°±æ˜¯ç½‘å…³ï¼ŒRuntimeï¼ŒRedis, Syslog é‚£äº›ä¸œè¥¿ï¼Œå·²ç»åšå¾—æ»šç“œçƒ‚ç†Ÿäº†ã€‚è¿™æ¬¡æ‰“ç®—è‡ªå·±ç¼–è¯‘ OpenRestyï¼Œè°ƒæ•™å‡ºä¸€ä¸ªé«˜æ€§èƒ½ç½‘å…³ï¼Œäºæ˜¯å¼„å¥½äº† OpenRestyï¼Œä¹Ÿé¡ºæ‰‹æŠŠç”²æ–¹å‘è¿‡æ¥çš„ SSL è¯ä¹¦é…ç½®åˆ°äº† OpenResty ä¸Šã€‚é…ç½® HTTPS çš„è¿‡ç¨‹è·Ÿä»¥å‰ä¸€æ ·ï¼Œè®¾ç½®å¥½ ssl_certificate, ssl_certificate_key,listen 443 ssl http2 è¿™äº›ä¸œè¥¿ï¼Œå†é™„åŠ ä¸€äº› ssl_cipher æ–¹é¢çš„å‚æ•°ï¼Œopenresty -s reload å®Œäº‹ã€‚reload å®Œäº†ä¹‹åæˆ‘åœ¨æˆ‘æœ¬åœ°çš„ Chrome ä¸Šé€šè¿‡åŸŸåè®¿é—®äº† https://xxx.com (xxx.com) ä¸ºç”²æ–¹åŸŸåï¼Œä¸€å¼€å§‹å‡ æ¬¡è®¿é—®æ˜¯ ERROR_CONNECTION_RESETï¼Œæˆ‘ä¹Ÿä¸ä»¥ä¸ºç„¶ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„ OpenResty åˆš Reloadï¼Œä»¥åŠæˆ‘æœ¬æœºä¸Šå¸¸ç€çš„ Surge ä»£ç†æœ‰æ—¶å€™å¯èƒ½ä¼šæ–­çº¿ï¼Œæ‰€ä»¥æˆ‘ä»¥ä¸ºè¿™ç§æƒ…å†µæ¯”è¾ƒå¸¸è§ï¼Œåˆ·æ–°å‡ æ¬¡å°±å¥½äº†ï¼Œè§åˆ°äº† Welcome To OpenRestyã€‚æ™šä¸Šå›å®¶ä¹‹åå›¢é˜Ÿçš„å°ä¼™ä¼´å‘Šè¯‰æˆ‘ä»–è®¿é—®ä¸äº†è¿™ä¸ªæœåŠ¡å™¨çš„ httpsï¼Œæˆ‘è‡ªå·±è¯•äº†ä¸€ä¸‹ç¡®å®æ²¡æ³•è®¿é—®ï¼Œä¸€ç›´æç¤º ERROR_CONNECTION_RESETï¼Œå¶å°”æˆåŠŸã€‚è¿™æ—¶å€™æˆ‘æ‰å¼€å§‹é‡è§†èµ·æ¥ï¼Œå‡†å¤‡ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ç—‡çŠ¶åœ¨æœ¬æœºä¸Š curl åªæœ‰æå°çš„æ¦‚ç‡ä¼šè¿”å›æ­£ç¡®ç»“æœï¼Œå¤§éƒ¨åˆ†æ—¶å€™è¿”å›12$ curl https://xxx.comcurl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to xxx.com:443åœ¨é˜¿é‡Œäº‘åŒä¸€ VPC å†…å…¶ä»–æœºå™¨ curl åˆ™å¿…æˆåŠŸæ— è®ºåœ¨å“ªé‡Œç›´æ¥ curl -k https://&lt;ip&gt; éƒ½æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„æ’æŸ¥é—®é¢˜è¿‡ç¨‹ä¹‹å‰ç”¨çš„ SSL è¯ä¹¦éƒ½æ˜¯ä½¿ç”¨ certbot æ¥è‡ªåŠ©ç­¾å‘ Let's Encrypt çš„ä¸‰ä¸ªæœˆè¯ä¹¦ï¼Œè¿™æ¬¡ä½¿ç”¨çš„æ˜¯åœ¨é˜¿é‡Œäº‘ä¹°çš„ Encryption Everywhere DV TLS CA - G1 ç­¾å‘çš„è¯ä¹¦ï¼Œæˆ‘çŒœæµ‹ç”²æ–¹å‘ç»™æˆ‘çš„è¯ä¹¦æ ¼å¼æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¾ˆå¿«å¦å®šäº†è¿™ä¸ªçŒœæµ‹ï¼Œå› ä¸ºå‰é¢è®²åˆ°åˆ·æ–°å¤šå‡ æ¬¡è¿˜æ˜¯èƒ½è®¿é—®çš„ï¼Œå¹¶ä¸” Chrome èƒ½å¤Ÿç»™å‡ºæ­£ç¡®çš„è¯ä¹¦ä¿¡æ¯ã€‚ä¹‹å‰æ²¡æœ‰ç”¨è¿‡è‡ªå·±ç¼–è¯‘çš„ OpenRestyï¼Œäºæ˜¯æˆ‘æ¢äº†ä¸ªé¢„ç¼–è¯‘ç‰ˆçš„ nginxï¼Œä¹Ÿå°±æ˜¯ç›´æ¥é€šè¿‡ yum install nginx æ¥å®‰è£…çš„ nginxï¼Œé—®é¢˜ä¾æ—§ã€‚å¼€äº† wireshark æ¥æŠ“åŒ…å¯ä»¥å‘ç°è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼šTCP Handshake -&gt; SSL Client Hello -&gt; Reset(Server sent)æˆ‘æœ‰å¹¸åœ°æŠ“åˆ°äº†éƒ¨åˆ†æ²¡æœ‰è¢« Reset çš„è¯·æ±‚ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒæˆåŠŸçš„è¯·æ±‚çš„ Client Helloä¸è¢« Reset çš„ Client Hello çš„å¤§å°éƒ½æ˜¯ 583 Byteï¼Œå¹¶ä¸”æˆ‘è¯¦ç»†çš„å¯¹æ¯”äº†ä¸¤ä¸ª Packetï¼Œå‘ç°é™¤äº†æ—¶é—´æˆ³ä»¥åŠå¿…è¦çš„éšæœºæ•°ä¹‹å¤–å¹¶æ²¡æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚æˆ‘æŸ¥çœ‹ä¸€ä¸‹äº† OpenResty çš„é”™è¯¯æ—¥å¿—ï¼Œå‘ç°æœ‰å¤§é‡çš„ peer closed connection in SSL handshakeï¼š1234562019/05/09 22:23:48 [info] 5182#0: *5543 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:4432019/05/09 22:23:49 [info] 5183#0: *5544 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:4432019/05/09 22:23:49 [info] 5183#0: *5545 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:4432019/05/09 22:23:50 [info] 5183#0: *5546 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:4432019/05/09 22:23:50 [info] 5182#0: *5547 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:4432019/05/09 22:23:50 [info] 5183#0: *5548 peer closed connection in SSL handshake (104: Connection reset by peer) while SSL handshaking, client: &lt;ip&gt;, server: 0.0.0.0:443ä¹Ÿå°±æ˜¯è¯´ï¼ŒOpenResty è®¤ä¸ºå®¢æˆ·ç«¯åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­ä¸»åŠ¨å…³é—­äº†è¿æ¥ï¼Œä½†æ˜¯æˆ‘çš„æŠ“åŒ…ç»“æœå´æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨ RST äº†è¿æ¥ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°å¾ˆç–‘æƒ‘ï¼Œä¸ºä½•ä¸¤ç«¯èƒ½å¾—å‡ºä¸ä¸€æ ·çš„ç»“è®ºã€‚ç”±äºä¸æ˜¯å¾ˆç†è§£ SSL æ¡æ‰‹çš„æœºåˆ¶ï¼Œæˆ‘çŒœæµ‹ OpenSSL æ¥ç®¡äº†è¿™ä¸€è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘é‡æ–°ç¼–è¯‘äº† OpenRestyï¼ŒåŠ ä¸Šäº†æœ€æ–°ç‰ˆçš„ OpenSSLï¼Œé—®é¢˜ä¾æ—§ã€‚è‡³æ­¤æˆ‘æ²¡è¾™äº†ï¼Œåªèƒ½ Google, StackOverflow ä¸€éä¸€éåœ°æœï¼Œæœåˆ°äº†ç”¨ç›´æ¥ OpenSSL æ¥å»ºç«‹ SSL è¿æ¥çš„æ–¹æ³•ï¼Œäºæ˜¯æˆ‘12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455$ openssl s_client -connect xxx.com:443CONNECTED(00000005)depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root CAverify return:1depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption Everywhere DV TLS CA - G1verify return:1depth=0 CN = &lt;Hidden Part&gt;verify return:1---Certificate chain 0 s:/CN=e.duchenggo.com i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=Encryption Everywhere DV TLS CA - G1 1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=Encryption Everywhere DV TLS CA - G1 i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert Global Root CA---Server certificate&lt;Hidden Part&gt;subject=/CN=&lt;Hidden Part&gt;issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=Encryption Everywhere DV TLS CA - G1---No client certificate CA names sentServer Temp Key: ECDH, X25519, 253 bits---SSL handshake has read 3246 bytes and written 285 bytes---New, TLSv1/SSLv3, Cipher is ECDHE-RSA-CHACHA20-POLY1305Server public key is 2048 bitSecure Renegotiation IS supportedCompression: NONEExpansion: NONENo ALPN negotiatedSSL-Session: Protocol : TLSv1.2 Cipher : ECDHE-RSA-CHACHA20-POLY1305 Session-ID: E5BC4CB0FFCA949F99859E6F2B6AE6D8742C6F6723EF7388ED7AED4F81C01126 Session-ID-ctx: Master-Key: 86D3EB1512786A84CE6E0ACF43362174345399F7C32A89B725893D2791AF87EBD1F642600CCA9919D57CDCB6FF6B203B TLS session ticket lifetime hint: 300 (seconds) TLS session ticket: 0000 - 85 3a da c6 e3 ab 66 f9-7b f8 e7 cd f6 a5 da e9 .:....f.{....... 0010 - ba bc d9 15 74 cf 8d b0-56 ea 4d c9 b4 f3 b7 d1 ....t...V.M..... 0020 - 1f 47 c1 1e ac 56 13 16-ca 6c d0 b8 bd 28 15 ea .G...V...l...(.. 0030 - 59 b3 79 84 b0 40 34 a4-57 e9 d1 12 c2 b5 5e 0f Y.y..@4.W.....^. 0040 - 77 02 ff 8b 4c 23 2b 89-b6 25 61 15 af 77 7c 75 w...L#+..%a..w|u 0050 - 6c 1f 80 66 27 0b 90 c4-36 43 e0 ee 75 f9 2d 99 l..f'...6C..u.-. 0060 - a0 af d3 bf 6d 12 05 f9-13 21 46 fd 41 a8 56 da ....m....!F.A.V. 0070 - df ec 89 68 d1 71 9d 15-2e 2f fa de 89 6a a0 8e ...h.q.../...j.. 0080 - 82 45 85 ca 3b 26 a0 e8-64 a9 56 82 da cf 04 4d .E..;&amp;..d.V....M 0090 - 42 13 dc 25 17 aa 38 1e-36 0a 8f 66 b5 26 57 2c B..%..8.6..f.&amp;W, 00a0 - 70 5e ff 0b 41 eb 49 f1-b0 8b 86 fd e6 c1 36 28 p^..A.I.......6( Start Time: 1557413139 Timeout : 7200 (sec) Verify return code: 0 (ok)---æˆåŠŸå»ºç«‹äº† SSL è¿æ¥ï¼Œæ˜¾ç¤ºçš„è¯ä¹¦ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡æ‰§è¡Œéƒ½èƒ½ç¨³å®šå»ºç«‹è¿æ¥ï¼Œè€Œä¸æ˜¯çœ‹è¿æ°”æ‰èƒ½è¿æ¥å¾—ä¸Šï¼Œæˆ‘æŠ“åŒ…äº†è¿™ä¸ªå»ºç«‹è¿‡ç¨‹ï¼Œå‘ç°è¿™ç§ Client Hello æ˜¯ä¸æºå¸¦ SNI Extension çš„ï¼Œå¦‚æœæˆ‘æ‰‹åŠ¨ç»™ä»–é™„ä¸Š SNI å‘¢ï¼Ÿ12345678910111213141516171819202122232425$ openssl s_client xxx.com:443 -servername xxx.comCONNECTED(00000005)write:errno=54---no peer certificate available---No client certificate CA names sent---SSL handshake has read 0 bytes and written 0 bytes---New, (NONE), Cipher is (NONE)Secure Renegotiation IS NOT supportedCompression: NONEExpansion: NONENo ALPN negotiatedSSL-Session: Protocol : TLSv1.2 Cipher : 0000 Session-ID: Session-ID-ctx: Master-Key: Start Time: 1557413484 Timeout : 7200 (sec) Verify return code: 0 (ok)---æœä¸å…¶ç„¶ï¼Œæ— æ³•å®Œæˆæ¡æ‰‹ï¼é”å®šå…ƒå‡¶ç»è¿‡ä¸€ç³»åˆ—æ’æŸ¥ä¹‹åï¼Œç»ˆäºå‘ç°æºå¸¦äº† SNI çš„ SSL æ¡æ‰‹è¯·æ±‚å¤§æ¦‚ç‡ä¼šè¢« â€œç¥ç§˜åŠ›é‡â€ Resetã€‚è”æƒ³åˆ°è¿™ä¸ªåŸŸåè¿˜æ²¡æœ‰æ¥å¾—åŠå¤‡æ¡ˆï¼Œæˆ‘çŒœæƒ³å¤§æ¦‚å°±æ˜¯å› ä¸ºæ²¡æœ‰å¤‡æ¡ˆæ‰€ä»¥è¢«å¹²æ‰°ã€‚ä½†æ˜¯ä»¥å‰çš„æœªå¤‡æ¡ˆåªæ˜¯ HTTP ä¼šè¢«åŠ«æŒæµé‡ï¼Œéš¾é“é˜¿é‡Œäº‘å·²ç»å¢å¼ºäº†æŠ€æœ¯å¼€å§‹å¹²æ‰°æœªå¤‡æ¡ˆåŸŸåçš„ HTTPS è¿æ¥äº†å—ï¼Ÿæœç´¢äº†ä¸€ç•ªå‘ç°å¾ˆæ—©ä¹‹å‰å°±æœ‰äººè®¨è®ºè¿‡è¿™ä¸ªé—®é¢˜äº†v2ex - é˜¿é‡Œäº‘ç«Ÿç„¶ä¹Ÿèƒ½ RESET æ‰ HTTPS é“¾æ¥äº†..?v2ex - é˜¿é‡Œäº‘é¦™æ¸¯å’Œæ–°åŠ å¡ HTTPS æå…¶ä¸ç¨³å®šè‡³æ­¤ç»“æŸè°ƒæŸ¥ï¼Œè¯·ç”²æ–¹å»å¯¹åŸŸåè¿›è¡Œå¤‡æ¡ˆã€‚çœŸæ˜¯ä¸€ä¸ªæ— èŠçš„è°ƒæŸ¥ç»“æœï¼Œä¸è¿‡ä¹Ÿæ˜¯è®°å½•ä¸€ä¸‹ï¼Œå¸Œæœ›å…¶ä»–äººé‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™èƒ½å¤Ÿæœåˆ°æˆ‘çš„æ–‡ç« åˆ«å†æµªè´¹æ—¶é—´åˆ°è¿™ä¸ªé—®é¢˜ä¸Š","link":"/2019/05/09/wired-ssl-handshake-reset/"}],"tags":[{"name":"redis","slug":"redis","link":"/tags/redis/"},{"name":"study","slug":"study","link":"/tags/study/"},{"name":"DIY","slug":"DIY","link":"/tags/DIY/"},{"name":"Medis","slug":"Medis","link":"/tags/Medis/"},{"name":"kubernetes","slug":"kubernetes","link":"/tags/kubernetes/"},{"name":"å­¦ä¹ æœ­è®°","slug":"å­¦ä¹ æœ­è®°","link":"/tags/å­¦ä¹ æœ­è®°/"},{"name":"GitHub Actions","slug":"GitHub-Actions","link":"/tags/GitHub-Actions/"},{"name":"å»ºç«™ä¹‹è·¯","slug":"å»ºç«™ä¹‹è·¯","link":"/tags/å»ºç«™ä¹‹è·¯/"},{"name":"CI","slug":"CI","link":"/tags/CI/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"è¸©å‘","slug":"è¸©å‘","link":"/tags/è¸©å‘/"},{"name":"Nginx","slug":"Nginx","link":"/tags/Nginx/"},{"name":"SSL","slug":"SSL","link":"/tags/SSL/"}],"categories":[{"name":"LifeRecorder","slug":"LifeRecorder","link":"/categories/LifeRecorder/"},{"name":"Study","slug":"Study","link":"/categories/Study/"},{"name":"ShareAnything","slug":"ShareAnything","link":"/categories/ShareAnything/"},{"name":"Debugging","slug":"Debugging","link":"/categories/Debugging/"}]}